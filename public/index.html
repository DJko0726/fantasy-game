<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Basketball</title>
    <style>

    </style>
</head>

<body>
    <label for="select-season">選擇賽季：</label>
    <select id="select-season"></select>
    <button id="update-season">更新賽季資料</button>

    <button id="insert-season">新增賽季資料</button>

    <br>
    <label for="select-player">選擇球員：</label>
    <select id="select-player"></select>

    <br>
    <button id="search-button">搜尋</button>

    <script>
        let availableSeasons = []

        fetch('/season-list')
            .then(response => response.json())
            .then(data => {
                const selectSeasonElement = document.getElementById('select-season')
                availableSeasons = data.result.season_year
                data.result.season_year.forEach(year => {
                    const option = document.createElement('option')
                    option.textContent = year;
                    selectSeasonElement.appendChild(option)
                })
            })
            .catch(error => console.error('Error fetching season data:', error))

        document.getElementById('select-season').addEventListener('change', function () {
            const selectedSeason = this.value;
            fetch('/player-list', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    season: selectedSeason
                })
            })
                .then(response => response.json())
                .then(data => {
                    const selectPlayerElement = document.getElementById('select-player')
                    selectPlayerElement.innerHTML = ''; // 清空球員列表

                    data.result.player_name.forEach(player => {
                        const option = document.createElement('option')
                        option.textContent = player
                        selectPlayerElement.appendChild(option)
                    });
                })
                .catch(error => {
                    console.error('Error loading:', error)
                })
        })

        document.getElementById('update-season').addEventListener('click', function () {
            const selectedSeason = document.getElementById('select-season').value

            const loadingMessage = document.createElement('p')
            loadingMessage.textContent = 'Updating data...'
            document.body.appendChild(loadingMessage)

            fetch('/player-update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    season_year: selectedSeason
                })
            })
                .then(response => response.json())
                .then(data => {
                    document.body.removeChild(loadingMessage);
                    alert('更新完成');
                })
                .catch(error => {
                    document.body.removeChild(loadingMessage);
                    console.error('Error updating:', error);
                });
        });

        document.getElementById('insert-season').addEventListener('click', function () {
            const userInput = prompt('請輸入要新增的賽季');

            if (userInput !== null && !isNaN(userInput) && userInput >= 2000 && !availableSeasons.includes(userInput)) {
                const loadingMessage = document.createElement('p')
                loadingMessage.textContent = 'Inserting data...'
                document.body.appendChild(loadingMessage)

                fetch('/player-update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        season_year: userInput
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        document.body.removeChild(loadingMessage)
                        alert(userInput + '賽季新增完成');
                        location.reload(); // 重新加載頁面
                    })
                    .catch(error => {
                        document.body.removeChild(loadingMessage)
                        console.error('Error inserting:', error)
                    })
            } else {
                alert('請輸入有效且未存在的賽季年份 (2000年之後)')
            }
        })

        document.getElementById('search-button').addEventListener('click', function () {
            const selectedSeason = document.getElementById('select-season').value
            const selectedPlayer = document.getElementById('select-player').value

            fetch('/player-get', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    season: selectedSeason,
                    player: selectedPlayer
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Search result:', data)
                })
                .catch(error => console.error('Error searching:', error))
        })

    </script>
</body>

</html>